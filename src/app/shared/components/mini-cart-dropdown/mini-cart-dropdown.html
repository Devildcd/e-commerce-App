@if (isOpen()) {
  <div
    class="absolute right-0 mt-3 w-[22rem] max-w-[calc(100vw-2rem)] rounded-2xl border border-slate-200/70 bg-white/95 p-4 shadow-xl backdrop-blur"
    role="dialog"
    aria-label="Productos en el carrito"
  >
    <!-- Header del dropdown -->
    <div class="flex items-start justify-between gap-3">
      <div>
        <p class="text-sm font-semibold text-slate-900">My Cart</p>
        <p class="text-xs text-slate-500">
          {{ totalItems() }} item{{ totalItems() === 1 ? '' : 's' }}
          select{{ totalItems() === 1 ? '' : 'ed' }}
        </p>
      </div>

      <button
        type="button"
        (click)="close()"
        class="rounded-lg p-2 text-slate-500 transition hover:bg-slate-100 hover:text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-300"
        aria-label="Cerrar"
      >
        <span class="material-symbols-outlined text-[18px]"> close </span>
      </button>
    </div>

    <!-- Empty state -->
    @if (items().length === 0) {
      <div
        class="mt-4 rounded-xl border border-dashed border-slate-200 p-6 text-center"
      >
        <p class="text-sm font-medium text-slate-800">
          Your cart is empty
        </p>
        <p class="mt-1 text-xs text-slate-500">
          Add products to see them here
        </p>

        <button
          type="button"
          class="mt-4 inline-flex w-full items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-800"
          (click)="close()"
        >
          Explore products
        </button>
      </div>
    } @else {
  <!-- Body: lista scrolleable + footer fijo -->
  <div class="mt-4 flex max-h-[70vh] flex-col">
    <!-- Lista (solo esto scrollea) -->
    <div class="min-h-0 flex-1 overflow-y-auto pr-1">
      <div class="space-y-3">
        @for (item of items(); track item.productId) {
          <div class="flex gap-3 rounded-xl p-2 transition hover:bg-slate-50">
            <img
              [src]="item.product.image"
              [alt]="item.product.title"
              class="h-14 w-14 flex-none rounded-xl border border-slate-200 object-cover"
              loading="lazy"
            />

            <div class="min-w-0 flex-1">
              <div class="flex items-start justify-between gap-2">
                <p class="truncate text-sm font-medium text-slate-900">
                  {{ item.product.title }}
                </p>

                <button
                  type="button"
                  (click)="removeItem(item.productId)"
                  class="rounded-lg p-2 text-slate-400 transition hover:bg-slate-100 hover:text-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-300"
                  aria-label="Eliminar producto"
                >
                  <span class="material-symbols-outlined text-[18px]">delete</span>
                </button>
              </div>

              <div class="mt-1 flex items-center justify-between text-xs">
                <span class="text-slate-600">
                  Cant: <span class="font-semibold text-slate-800">{{ item.quantity }}</span>
                </span>
                <span class="font-semibold text-slate-900">
                  {{ item.unitPrice | currency : 'USD' : 'symbol' : '1.2-2' }}
                </span>
              </div>

              <div class="mt-1 flex items-center justify-between text-xs text-slate-500">
                <span>
                  {{ item.unitPrice | currency : 'USD' : 'symbol' : '1.2-2' }} Ã— {{ item.quantity }}
                </span>
                <span class="font-semibold text-slate-700">
                  {{ item.unitPrice * item.quantity | currency : 'USD' : 'symbol' : '1.2-2' }}
                </span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Footer fijo dentro del panel -->
    <div
  class="sticky bottom-0 mt-3 border-t border-slate-200/70 bg-white/95 px-4 pb-4 pt-3 backdrop-blur"
>
  <div class="flex items-center justify-between text-sm">
    <span class="text-slate-600">Subtotal</span>
    <span class="text-base font-semibold text-slate-900">
      {{ subtotal() | currency : 'USD' : 'symbol' : '1.2-2' }}
    </span>
  </div>

  <p class="mt-1 text-xs text-slate-500">
    Taxes and shipping are calculated at checkout
  </p>

  <div class="mt-3 grid grid-cols-1 gap-2 sm:grid-cols-2">
    <a
      class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 transition hover:bg-slate-50"
      (click)="close()"
    >
      View cart
    </a>

    <button
      class="inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-800"
      (click)="goToCheck()"
    >
      Checkout
    </button>
  </div>
</div>
  </div>
}
  </div>
}